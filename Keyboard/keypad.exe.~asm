ASSUME CS:CODE, DS:DATA
PORTA1 EQU 8000H
PORTB1 EQU 8002H
PORTC1 EQU 8004H
CWR1   EQU 8006H

PORTA2 EQU 9000H
PORTB2 EQU 9002H
PORTC2 EQU 9004H
CWR2   EQU 9006H

DATA SEGMENT
KEYCODE DB 01H,02H,03H,04H,05H,06H,07H,08H,09H,0AH
DATA ENDS

CODE SEGMENT
START:
;INITIALIZING DATA SEGMENT
MOV AX,DATA
MOV DS,AX
;WRITING CONTROL WORD FOR 8255-1
MOV AL,82H
MOV DX,CWR1
OUT DX,AL
;MAKING ALL ROWS ZERO
MOV AL,00H
MOV DX,PORTA1
OUT DX,AL
;READING THE COLUMNS
MOV DX,PORTB1
LOOP1:
IN AL,DX
;CHECKING IF ANY KEY IS PRESSED
CMP AL,0FFH
JNZ LOOP1
;FOR REAL
IN AL,DX
CHECK:
CMP AL,0FFH
JZ CHECK
;GETTING KEYCODE
MOV BL,01H
FIND_COL:
RCR AL,01H
JNC FIND_ROW
INC BL
CMP BL,08H
JNZ FIND_COL
;GETTING ROW
FIND_ROW:
MOV CL,01H
MOV CH,01H
LOOP2:
MOV AL,CH
MOV DX,PORTA1
OUT DX,AL
MOV DX,PORTB1
IN AL,DX
CMP AL,0FFH
JNZ FOUND_ROW
ROL CH,01H
INC CL
CMP CL,08H
JNZ LOOP2
;COMPUTING 8*BL+CL
FOUND_ROW:
MOV AL,08H
MUL AL
ADD AL,CL
MOV DX,PORTC1
OUT DX,AL
CODE ENDS
END START






; [SOURCE]: F:\6th_Semester\Advanced_Micro\Internals\keypad.asm
